<!-- <!DOCTYPE html>
<html>
<head>
  <title>BusPe UPI Payment</title>
</head>
<body>
  <h2>BusPe - Enter Fare Amount</h2>

  <div id="info"></div>
  <div>
    <label for="amount">Enter Fare Amount (‚Çπ): </label>
    <input type="number" id="amount" required />
    <button onclick="generateLink()">Generate UPI Link</button>
  </div>

  <div id="payment" style="margin-top: 20px; display: none;">
    <p id="upiInfo"></p>
    <a id="payBtn" href="#" style="padding: 10px; background: green; color: white; text-decoration: none;">Pay with UPI</a>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const upi = urlParams.get('upi');

    if (!upi) {
      document.getElementById("info").innerText = "Error: UPI ID is missing in the link.";
      document.querySelector("input").disabled = true;
    }

    function generateLink() {
      const amount = document.getElementById("amount").value;
      if (!amount || amount <= 0) {
        alert("Please enter a valid amount.");
        return;
      }

      const upiLink = `upi://pay?pa=${upi}&pn=BusOwner&am=${amount}&cu=INR`;

      document.getElementById("payment").style.display = "block";
      document.getElementById("upiInfo").innerText = `Click below to pay ‚Çπ${amount} to ${upi}`;
      document.getElementById("payBtn").href = upiLink;
    }
  </script>
</body>
</html>
 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BusPe Fare Payment</title>
  <script>
    // Save UPI and Bus Number locally for this session
    function saveOwnerInfo() {
      const upi = document.getElementById("upi").value;
      const busNumber = document.getElementById("busNumber").value;

      if (!upi || !busNumber) {
        alert("Please fill in both UPI ID and Bus Number.");
        return;
      }

      localStorage.setItem("upiId", upi.trim());
      localStorage.setItem("busNumber", busNumber.trim());
      alert("Owner details saved. Passengers can now enter fare.");
    }

    // Generate QR Code and UPI deep link using saved UPI and Bus #
    function generateQR() {
      const amount = document.getElementById("amount").value;
      const upiId = localStorage.getItem("upiId");
      const busNumber = localStorage.getItem("busNumber");

      if (!upiId || !busNumber) {
        alert("Owner info not set. Please set UPI and Bus Number first.");
        return;
      }

      if (!amount || isNaN(amount) || amount <= 0) {
        alert("Enter a valid amount.");
        return;
      }

      const upiUrl = `upi://pay?pa=${upiId}&pn=Bus ${busNumber}&am=${amount}&cu=INR`;

      document.getElementById("qr").src =
        `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiUrl)}`;

      const link = document.getElementById("upiLink");
      link.href = upiUrl;
      link.innerText = "Click here to pay using UPI";
    }
  </script>
</head>
<body>
  <h2>üöå BusPe - Digital Bus Fare</h2>

  <h4>üë®‚Äçüîß Bus Owner Setup</h4>
  <input type="text" id="upi" placeholder="Enter UPI ID (e.g. owner@bank)" />
  <input type="text" id="busNumber" placeholder="Enter Bus Number (e.g. KL07AX1234)" />
  <button onclick="saveOwnerInfo()">Save Bus Owner Info</button>

  <hr />

  <h4>üë§ Passenger Fare Input</h4>
  <input type="number" id="amount" placeholder="Fare Amount" />
  <button onclick="generateQR()">Generate Payment QR</button>

  <div style="margin-top: 20px;">
    <img id="qr" src="" alt="QR Code will appear here" />
    <br />
    <a id="upiLink" target="_blank"></a>
  </div>
</body>
</html>
